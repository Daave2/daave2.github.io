<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Cleveleys Morrisons Management Dashboard for tasks, notes, scheduling, and operational guides.">
  <title>Cleveleys Morrisons Management Dashboard - Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* --------------------------------------------------
       CSS Variables for Light and Dark Themes
       -------------------------------------------------- */
    :root {
      --primary-green: #006400; --secondary-yellow: #FFD700; --background-faint-green: #e6ffe6; --background-white: #FFFFFF; --text-color: #333333; --card-bg: var(--background-white); --card-shadow: rgba(0, 0, 0, 0.1); --footer-bg: var(--primary-green); --footer-text: var(--background-white);
      /* Dark Mode Variables */
      --dark-background: #121212; --dark-card-bg: #1e1e1e; --dark-text-color: #e0e0e0; --dark-footer-bg: #333333; --dark-footer-text: #e0e0e0;
    }
    /* --------------------------------------------------
       Reset and Base Styles
       -------------------------------------------------- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background-color: var(--background-faint-green); color: var(--text-color); line-height: 1.6; transition: background-color 0.3s, color 0.3s; }
    body.dark-mode { background-color: var(--dark-background); color: var(--dark-text-color); --card-bg: var(--dark-card-bg); }
    a { color: inherit; text-decoration: none; }
    body.mobile-nav-open { overflow: hidden; }
    /* --------------------------------------------------
       Header Styles
       -------------------------------------------------- */
    header { background-color: var(--background-white); color: var(--primary-green); padding: 20px 10px; text-align: center; position: relative; box-shadow: 0 2px 4px var(--card-shadow); transition: background-color 0.3s, color 0.3s; }
    body.dark-mode header { background-color: var(--dark-card-bg); color: var(--dark-text-color); box-shadow: 0 2px 4px var(--dark-card-bg); }
    header img { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); height: 50px; transition: none; }
    header h1 { font-size: 2em; margin: 0; padding-left: 80px; }
    /* --------------------------------------------------
       Navigation
       -------------------------------------------------- */
     nav.nav { position: sticky; top: 0; z-index: 1000; background-color: var(--secondary-yellow); box-shadow: 0 2px 15px rgba(0,0,0,0.1); transition: background-color 0.3s; }
    body.dark-mode nav.nav { background-color: #333; box-shadow: 0 2px 15px rgba(0,0,0,0.6); }
    .nav-container { display: flex; align-items: center; justify-content: space-between; max-width: 1200px; margin: 0 auto; padding: 0 20px; height: 60px; }
    .nav-links { display: flex; align-items: center; gap: 1rem; list-style: none; transition: transform 0.3s ease; }
    .nav-links li { position: relative; }
    .nav-links a { display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; font-weight: 500; color: var(--primary-green); border-radius: 8px; transition: background-color 0.3s, transform 0.3s, color 0.3s; }
    body.dark-mode .nav-links a { color: var(--dark-text-color); }
    .nav-links a:hover { background-color: var(--primary-green); color: var(--background-white); transform: translateY(-2px); }
    .nav-links .active { background-color: var(--primary-green); color: var(--background-white); }
    .nav-links a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 3px; background-color: var(--primary-green); border-radius: 2px; transition: width 0.3s ease; }
    .nav-links a:hover::after, .nav-links .active::after { width: 100%; }
    .hamburger { display: none; flex-direction: column; cursor: pointer; z-index: 1001; }
    .hamburger span { display: block; width: 25px; height: 3px; background: var(--primary-green); margin: 5px 0; transition: all 0.3s ease; }
    body.dark-mode .hamburger span { background: var(--dark-text-color); }
    .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
    .hamburger.active span:nth-child(2) { opacity: 0; }
    .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -6px); }
    .nav-actions { display: flex; align-items: center; gap: 1rem; }
    .dark-mode-toggle { background: none; border: none; cursor: pointer; font-size: 1.5em; color: var(--primary-green); transition: color 0.3s; }
    body.dark-mode .dark-mode-toggle { color: var(--dark-text-color); }
     @media (max-width: 992px) { /* Adjusted breakpoint for better nav wrapping */
        .hamburger { display: flex; }
        .nav-links { position: fixed; top: 60px; left: 0; right: 0; bottom: 0; background: var(--secondary-yellow); flex-direction: column; padding: 2rem 1rem; transform: translateX(-100%); transition: transform 0.3s ease-in-out; overflow-y: auto; z-index: 999; }
        body.dark-mode .nav-links { background: #333; }
        .nav-links.active { transform: translateX(0); }
        .nav-links li { margin: 0; width: 100%; }
        .nav-links a { margin: 0.5rem 0; width: 100%; justify-content: flex-start; padding: 1rem; font-size: 1.1em; border: 1px solid transparent; }
        body.dark-mode .nav-links a { color: var(--dark-text-color); }
        .nav-links a:hover { background-color: var(--primary-green); color: var(--background-white); border-color: var(--primary-green); }
        .nav-links .active { border-bottom: none; }
        .nav-links a::after { display: none; }
    }
    /* --------------------------------------------------
       Dashboard Section
       -------------------------------------------------- */
    #dashboard { margin-bottom: 30px; background-color: var(--card-bg); padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px var(--card-shadow); transition: background-color 0.3s, box-shadow 0.3s; }
    #dashboard h2 { color: var(--primary-green); margin-bottom: 15px; font-size: 1.6em; border-bottom: 2px solid var(--secondary-yellow); display: inline-block; padding-bottom: 5px; transition: color 0.3s, border-bottom-color 0.3s; }
    #dashboard .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 20px; }
    #dashboard .dashboard-item { background-color: var(--primary-green); color: var(--background-white); border-radius: 10px; text-align: center; padding: 20px 10px; text-decoration: none; transition: background-color 0.3s, transform 0.3s; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; min-height: 100px; /* Ensure consistent height */ }
    #dashboard .dashboard-item:hover { background-color: #004d00; transform: translateY(-2px); }
    #dashboard .dashboard-item i { font-size: 2em; margin-bottom: 10px; }
    #dashboard .dashboard-item span { font-weight: bold; font-size: 0.9em; }
    /* --------------------------------------------------
       Iframe Container for Dashboard Items
       -------------------------------------------------- */
    #frame-container { display: none; max-width: 1200px; margin: 20px auto; position: relative; }
    #frame-container.active { display: block; }
    #content-frame { width: 100%; height: 600px; border: none; box-shadow: 0 4px 12px var(--card-shadow); border-radius: 10px; background-color: var(--background-white); } /* Added background */
    #close-frame { position: absolute; top: -40px; right: 0; background-color: var(--primary-green); color: var(--background-white); border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; font-size: 0.9em; }
    #close-frame:hover { background-color: #004d00; }
    #fallback-message { display: none; text-align: center; margin-top: 10px; padding: 15px; background-color: var(--secondary-yellow); color: var(--primary-green); border-radius: 5px; }
    #fallback-message a { color: var(--primary-green); text-decoration: underline; font-weight: bold; }
    /* --------------------------------------------------
       Other Sections: Wheel, Who Is In Today, Management Rota, Notes
       -------------------------------------------------- */
    .container { padding: 20px; max-width: 1200px; margin: 20px auto; } /* Added top margin */
    main { margin-bottom: 30px; }
    section { margin-bottom: 30px; background-color: var(--card-bg); padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px var(--card-shadow); transition: background-color 0.3s, box-shadow 0.3s; }
    body.dark-mode section { background-color: var(--dark-card-bg); box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05); }
    section h2 { color: var(--primary-green); margin-bottom: 20px; font-size: 1.8em; border-bottom: 2px solid var(--secondary-yellow); display: inline-block; padding-bottom: 8px; transition: color 0.3s, border-bottom-color 0.3s; }
    body.dark-mode section h2 { color: var(--secondary-yellow); border-bottom-color: var(--primary-green); }
    section p { margin-bottom: 1em; }
    section ul { list-style: disc; margin-left: 25px; margin-bottom: 1em; }
    /* Iframe Container for Other Sections */
    .iframe-container { position: relative; padding-bottom: 56.25%; /* 16:9 Aspect Ratio */ height: 0; overflow: hidden; border-radius: 8px; box-shadow: 0 2px 8px var(--card-shadow); transition: box-shadow 0.3s, background-color 0.3s; margin-top: 15px; background-color: var(--background-white); /* Added background */ }
    body.dark-mode .iframe-container { background-color: var(--dark-card-bg); box-shadow: 0 2px 8px rgba(255,255,255,0.1); }
    .iframe-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    @media (max-width: 768px) { .iframe-container { padding-bottom: 75%; /* Adjust for smaller screens if needed */ } }
    /* --------------------------------------------------
       Whiteboard (Notes) Styles
       -------------------------------------------------- */
    .whiteboard-container { position: relative; width: 100%; height: 600px; /* Adjusted height */ border: 1px solid var(--primary-green); border-radius: 8px; background-color: #fff; overflow: hidden; transition: background-color 0.3s, border-color 0.3s; }
    body.dark-mode .whiteboard-container { background-color: #2e2e2e; border-color: var(--dark-text-color); }
    #whiteboard { width: 100%; height: 100%; cursor: crosshair; background-color: transparent; }
    .button-group { position: absolute; top: 10px; right: 10px; display: flex; flex-direction: column; gap: 8px; z-index: 10; }
    .button-group button { background-color: var(--primary-green); color: #fff; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 0.85em; transition: background-color 0.3s; display: flex; align-items: center; gap: 5px; }
    .button-group button:hover { background-color: #004d00; }
    body.dark-mode .button-group button { background-color: #444; color: var(--dark-footer-text); }
    body.dark-mode .button-group button:hover { background-color: #222; }
    .button-group button.active { outline: 2px solid var(--secondary-yellow); box-shadow: 0 0 5px var(--secondary-yellow); }
    .whiteboard-tools { position: absolute; top: 10px; left: 10px; display: flex; gap: 8px; background: rgba(255, 255, 255, 0.9); padding: 8px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 15; }
    body.dark-mode .whiteboard-tools { background: rgba(30, 30, 30, 0.9); }
    .color-picker, .brush-size { height: 30px; border: 1px solid #ccc; border-radius: 4px; background: var(--card-bg); cursor: pointer; padding: 0 5px; }
    body.dark-mode .color-picker, body.dark-mode .brush-size { background: var(--dark-card-bg); color: var(--dark-text-color); border-color: #555; }
    /* --------------------------------------------------
       Footer
       -------------------------------------------------- */
    footer { background-color: var(--footer-bg); color: var(--footer-text); text-align: center; padding: 15px 5px; width: 100%; transition: background-color 0.3s, color 0.3s; margin-top: 40px; /* Added margin */ }
    body.dark-mode footer { background-color: var(--dark-footer-bg); color: var(--dark-footer-text); }
    footer p { margin: 0; font-size: 0.9em; }
    /* --------------------------------------------------
       Smooth Scrolling & Accessibility Focus
       -------------------------------------------------- */
    html { scroll-behavior: smooth; }
    a:focus, button:focus, select:focus, input:focus, .hamburger:focus, [tabindex="0"]:focus { outline: 2px solid var(--primary-green); outline-offset: 2px; border-radius: 2px; /* Added for better visibility */ }
    body.dark-mode a:focus, body.dark-mode button:focus, body.dark-mode select:focus, body.dark-mode input:focus, body.dark-mode .hamburger:focus, body.dark-mode [tabindex="0"]:focus { outline-color: var(--secondary-yellow); }
    /* --------------------------------------------------
       Enhanced Loading Spinner for Iframes
       -------------------------------------------------- */
    .iframe-loading-container { position: relative; /* Required for absolute positioning of spinner */ }
    .iframe-loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-green); border-radius: 50%; animation: spin 1s linear infinite; z-index: 5; /* Ensure it's above iframe placeholder */ }
    body.dark-mode .iframe-loading { border-color: #555; border-top-color: var(--secondary-yellow); }
    @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
    /* Notification Style */
    .notification { display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--primary-green); color: white; padding: 10px 20px; border-radius: 5px; z-index: 2000; font-size: 0.9em; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    body.dark-mode .notification { background-color: var(--secondary-yellow); color: var(--dark-background); }

  </style>
</head>
<body>
  <header>
    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/8/82/MorrisonsLogo.svg/220px-MorrisonsLogo.svg.png" alt="Morrisons Logo">
    <h1>Cleveleys Morrisons Management Dashboard</h1>
  </header>

  <nav class="nav" role="navigation" aria-label="Primary Navigation">
    <div class="nav-container">
      <ul class="nav-links">
          <li><a href="index.html" class="active"><i class="fas fa-home"></i> Home</a></li>
          <li><a href="online.html"><i class="fas fa-globe"></i> Online</a></li>
          <li><a href="street.html"><i class="fas fa-store"></i> Market Street</a></li>
          <li><a href="services.html"><i class="fas fa-concierge-bell"></i> Front End</a></li>
          <li><a href="operations.html"><i class="fas fa-cogs"></i> Operations</a></li>
          <li><a href="contacts.html"><i class="fas fa-address-book"></i> Contacts</a></li>
          <li><a href="shrink.html"><i class="fas fa-compress-arrows-alt"></i> Shrink</a></li>
          <li><a href="safe-and-legal.html"><i class="fas fa-shield-alt"></i> Safe & Legal</a></li>
      </ul>
      <div class="nav-actions">
        <button class="dark-mode-toggle" aria-label="Toggle Dark Mode" aria-pressed="false">🌓</button>
      </div>
      <div class="hamburger" aria-label="Toggle Navigation Menu" aria-expanded="false" role="button" tabindex="0">
        <span></span><span></span><span></span>
      </div>
    </div>
  </nav>

  <div class="container">
    <main>
       <!-- Intro Section -->
       <section id="welcome">
        <h2>Welcome to the Dashboard</h2>
        <p>This dashboard provides quick access to essential tools, reports, and operational guides for Cleveleys Morrisons management. Use the navigation above or the quick links below to access different areas.</p>
        <p>Key operational principles like <strong>Customer First</strong> and the <strong>Manager In Charge (MIC)</strong> routines are central to our success. Familiarise yourself with these guides linked below and in the <a href="operations.html">Operations</a> section.</p>
        <ul>
            <li><strong>Customer First:</strong> Our commitment to serving every customer's unique needs. Key service asks include greeting customers, offering a basket, and answering questions positively. More details in the <a href="operations.html#customer-first">Operations Guide</a>.</li>
            <li><strong>Manager In Charge Routines:</strong> Daily structure includes Store Walks, Waste Validation, Rumble, Fit for 5 Handover, and Closedown processes. See the <a href="operations.html#mic-routines">Operations Guide</a> for summaries.</li>
        </ul>
      </section>

      <!-- Dashboard Quick Links Section -->
      <section id="dashboard">
        <h2>Quick Links Dashboard</h2>
        <div class="dashboard-grid">
          <!-- Tiles with data-open to decide behavior:
               data-open="frame" loads in the iframe,
               data-open="external" opens in a new tab -->
          <a href="https://storemobile.apps.mymorri.com/#/choose-option/218" class="dashboard-item" data-open="frame" title="Morrisons Store Mobile App">
            <i class="fas fa-mobile-alt"></i>
            <span>Store App</span>
          </a>
          <a href="https://www.dymension.co.uk/#/account/login" class="dashboard-item" data-open="frame" title="Dymension Staff Checks">
            <i class="fas fa-user-check"></i>
            <span>Staff Checks</span>
          </a>
          <a href="https://priceintegrity.apps.mymorri.com/#/checks" class="dashboard-item" data-open="external" title="Price Integrity Logbook">
            <i class="fas fa-book"></i>
            <span>Logbook</span>
          </a>
          <a href="https://morrisonsprd.cloud.looker.com/dashboards/retail::store_inbound_report" class="dashboard-item" data-open="external" title="Looker Delivery Volume Report">
            <i class="fas fa-chart-line"></i>
            <span>Delivery Volume</span>
          </a>
           <a href="https://morrisonsprd.cloud.looker.com/dashboards/32" class="dashboard-item" data-open="external" title="Retail Wheel Dashboard">
             <i class="fas fa-tachometer-alt"></i> <!-- Updated icon -->
             <span>Retail Wheel</span>
           </a>
          <a href="https://lookerstudio.google.com/u/0/reporting/b69cfd73-8c0a-453d-9c10-6561fa953f7c/page/p_bghtutfsbd" class="dashboard-item" data-open="external" title="Looker Studio NPS Report">
            <i class="fas fa-smile"></i>
            <span>NPS</span>
          </a>
          <a href="https://lookerstudio.google.com/u/1/reporting/b28a8a2b-e768-483f-bb21-c0452cf8592d/page/jhKME" class="dashboard-item" data-open="external" title="Looker Studio Transfers Report">
            <i class="fas fa-exchange-alt"></i>
            <span>Transfers</span>
          </a>
          <a href="https://script.google.com/a/macros/morrisonsplc.co.uk/s/AKfycbzIdtjqOn7Ktfs6SCOwIRdqEt0PFqt0sbR1zq8K-WJIyL9d5gXY3j0r5m3OVgIOyZIABw/exec" class="dashboard-item" data-open="external" title="Google Script - Complaints">
            <i class="fas fa-comments"></i>
            <span>Complaints</span>
          </a>
          <a href="https://script.google.com/a/macros/morrisonsplc.co.uk/s/AKfycbzZL9nqqm3g3dovfDamSnPlnuRnPa2c18oPUzMzxe3zywAT1kQVgNIWmWIH1LI1DMlz/exec" class="dashboard-item" data-open="external" title="Google Script - Complaints Reply">
            <i class="fas fa-reply"></i>
            <span>Complaints Reply</span>
          </a>
          <a href="https://script.google.com/a/macros/morrisonsplc.co.uk/s/AKfycbwcruXBXnOk0d1wlfZJHn4sy4IYpuj1GMtzSldMHAj2VWxNCKjEuGiEqCCpTfkWXUcp/exec" class="dashboard-item" data-open="external" title="Google Script - Reminders">
            <i class="fas fa-calendar-check"></i>
            <span>Reminders</span>
          </a>
           <!-- Links to internal pages -->
           <a href="operations.html" class="dashboard-item" data-open="self" title="Operational Guides">
             <i class="fas fa-cogs"></i>
             <span>Operations Guide</span>
           </a>
           <a href="shrink.html" class="dashboard-item" data-open="self" title="Shrink Management Guides">
             <i class="fas fa-compress-arrows-alt"></i>
             <span>Shrink Guide</span>
           </a>
        </div>
      </section>

      <!-- Content Frame Container for Dashboard Items -->
      <div id="frame-container">
        <button id="close-frame" title="Close Frame"><i class="fas fa-times"></i> Close</button>
        <div class="iframe-loading-container">
             <div class="iframe-loading"></div> <!-- Spinner -->
             <iframe id="content-frame" title="Embedded Content Frame" src="about:blank"></iframe>
        </div>
        <div id="fallback-message" role="alert">
          <p>Unable to load this page within the frame.<br>
          <a id="fallback-link" href="" target="_blank" rel="noopener noreferrer">Click here</a> to open it in a new tab.</p>
        </div>
      </div>

      <!-- Who Is In Today Section -->
      <section id="who-is-in">
        <h2>Who Is In Today?</h2>
         <div class="iframe-loading-container">
             <div class="iframe-loading"></div>
             <div class="iframe-container">
                 <iframe data-src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT_y-07M_h42TtOYaixA3J-8DNM9ifSLpQX2oASHEvSuzij4AtP_HwAX0TRwRX8hfcTSP-EJKiuNko6/pubhtml?gid=1881177460&amp;single=true&amp;widget=true&amp;headers=false" title="Who Is In Today Spreadsheet" loading="lazy"></iframe>
             </div>
         </div>
      </section>

      <!-- Management Rota Section -->
      <section id="management-rota">
        <h2>Management Rota</h2>
         <div class="iframe-loading-container">
             <div class="iframe-loading"></div>
             <div class="iframe-container">
                <iframe data-src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTYlntl23_036PdM7a3KIWjPjvq9AEXJdT6V_oCb9KHPfmu3tLBhcEDVwyVnY0c0Ye9-It8ZbS_PnAz/pubhtml?widget=true&amp;headers=false" title="Management Rota Spreadsheet" loading="lazy"></iframe>
             </div>
         </div>
      </section>

       <!-- Wheel Section (Optional - Can be linked externally too) -->
      <section id="wheel">
        <h2>Retail Wheel</h2>
        <p>Access the Retail Wheel for a comprehensive overview of store performance metrics.</p>
         <div class="iframe-loading-container">
             <div class="iframe-loading"></div>
             <div class="iframe-container">
              <!-- Placeholder link - update if a direct embed link is available -->
                 <iframe data-src="https://morrisonsprd.cloud.looker.com/dashboards/32" title="Retail Wheel Dashboard" loading="lazy"></iframe>
             </div>
         </div>
         <p style="margin-top: 1em;"><a href="https://morrisonsprd.cloud.looker.com/dashboards/32" target="_blank" rel="noopener noreferrer" class="button-link">Open Retail Wheel in New Tab <i class="fas fa-external-link-alt"></i></a></p>
      </section>

      <!-- Notes Section (Interactive Whiteboard) -->
      <section id="notes">
        <h2>Notes Whiteboard</h2>
        <p>Use the whiteboard below for quick notes or brainstorming. Drawings can be saved and loaded locally in your browser. Use the toolbar for color/size and the buttons for actions.</p>
        <div class="whiteboard-container">
          <div class="whiteboard-tools">
            <input type="color" class="color-picker" value="#000000" aria-label="Select drawing color" title="Drawing Color">
            <select class="brush-size" aria-label="Select brush size" title="Brush Size">
              <option value="2">Small</option>
              <option value="4" selected>Medium</option>
              <option value="8">Large</option>
              <option value="12">X-Large</option>
            </select>
          </div>
          <canvas id="whiteboard" aria-label="Interactive whiteboard for notes"></canvas>
          <div class="button-group">
            <button class="save-button" title="Save drawing to local storage"><i class="fas fa-save"></i> Save</button>
            <button class="load-button" title="Load drawing from local storage"><i class="fas fa-upload"></i> Load</button>
            <button class="undo-button" title="Undo last stroke"><i class="fas fa-undo"></i> Undo</button>
            <button class="fill-button" title="Fill canvas with current color"><i class="fas fa-fill-drip"></i> Fill</button>
            <button class="eraser-button" title="Toggle eraser tool"><i class="fas fa-eraser"></i> Eraser</button>
            <button class="clear-button" title="Clear whiteboard"><i class="fas fa-trash"></i> Clear</button>
            <button class="export-png-button" title="Download drawing as PNG image"><i class="fas fa-download"></i> Download</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <footer>
    <p>&copy; 2025 Cleveleys Morrisons. All rights reserved.</p>
    <!-- Eleven Labs AI Assistant Widget -->
    <!-- <elevenlabs-convai agent-id="nEnCEooAd1mpnRZYj3mR"></elevenlabs-convai> -->
    <!-- <script src="https://elevenlabs.io/convai-widget/index.js" async type="text/javascript"></script> -->
    <!-- Commented out as it might require specific setup/API keys -->
  </footer>

  <!-- Notification Element -->
  <div class="notification" id="notification" role="alert" aria-live="assertive"></div>

  <!-- JavaScript -->
  <script>
    (function() {
      'use strict';
      /* --- Helper: Debounce --- */
      function debounce(func, wait) { /* ... debounce implementation ... */ }

      /* --- Dark Mode Toggle --- */
      const darkModeToggleButtons = document.querySelectorAll('.dark-mode-toggle');
      function setDarkMode(isDark) {
          document.body.classList.toggle('dark-mode', isDark);
          darkModeToggleButtons.forEach(btn => btn.setAttribute('aria-pressed', isDark));
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
          // Re-render whiteboard on theme change to update eraser color etc.
          if (typeof renderAll === 'function') {
             setTimeout(resizeCanvas, 50); // Allow transition slightly
          }
      }
      darkModeToggleButtons.forEach(btn => {
          btn.addEventListener('click', () => setDarkMode(!document.body.classList.contains('dark-mode')));
      });
      // Apply saved theme on initial load
       const savedTheme = localStorage.getItem('theme');
       if (savedTheme) {
           setDarkMode(savedTheme === 'dark');
       } else {
           // Optional: Check system preference if no setting saved
           const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
           setDarkMode(prefersDark);
       }
       // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (!localStorage.getItem('theme')) { // Only follow system if user hasn't set preference
                setDarkMode(event.matches);
            }
        });


      /* --- Mobile Navigation Toggle --- */
       const hamburger = document.querySelector('.hamburger');
       const navLinks = document.querySelector('.nav-links');
       if (hamburger && navLinks) {
           hamburger.addEventListener('click', (e) => {
               e.stopPropagation();
               const isActive = navLinks.classList.toggle('active');
               hamburger.classList.toggle('active');
               hamburger.setAttribute('aria-expanded', isActive);
               document.body.classList.toggle('mobile-nav-open', isActive);
           });
            hamburger.addEventListener('keypress', (e) => {
               if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); hamburger.click(); }
           });
           document.addEventListener('click', (e) => {
               if (navLinks.classList.contains('active') && !navLinks.contains(e.target) && !hamburger.contains(e.target)) {
                   navLinks.classList.remove('active');
                   hamburger.classList.remove('active');
                   hamburger.setAttribute('aria-expanded', 'false');
                   document.body.classList.remove('mobile-nav-open');
               }
           });
           navLinks.querySelectorAll('a').forEach(link => {
               link.addEventListener('click', () => {
                   if (navLinks.classList.contains('active')) {
                       navLinks.classList.remove('active');
                       hamburger.classList.remove('active');
                       hamburger.setAttribute('aria-expanded', 'false');
                       document.body.classList.remove('mobile-nav-open');
                   }
               });
           });
       }


      /* --- Smooth Scroll for In-Page Links (if any added later) --- */
      // document.querySelectorAll('a[href^="#"]').forEach(anchor => { /* ... smooth scroll logic ... */ });

      /* --- Notification System --- */
      function showNotification(message, duration = 3000) {
          const notification = document.getElementById('notification');
          if (!notification) return;
          notification.textContent = message;
          notification.style.display = 'block';
          // Fade out effect (optional)
          notification.style.opacity = 1;
          setTimeout(() => {
               notification.style.opacity = 0;
               setTimeout(() => { notification.style.display = 'none'; }, 300); // Wait for fade out
           }, duration);
      }

       /* --- Dashboard Item Click Handler & Iframe --- */
       const dashboardItems = document.querySelectorAll('#dashboard .dashboard-item');
       const frameContainer = document.getElementById('frame-container');
       const contentFrame = document.getElementById('content-frame');
       const closeFrame = document.getElementById('close-frame');
       const fallbackMessage = document.getElementById('fallback-message');
       const fallbackLink = document.getElementById('fallback-link');
       const frameSpinner = frameContainer ? frameContainer.querySelector('.iframe-loading') : null; // Spinner inside frame container
       let frameLoadTimeout;

       function showFrameSpinner(show) {
           if (frameSpinner) frameSpinner.style.display = show ? 'block' : 'none';
       }

       function loadContentInFrame(url) {
           if (!frameContainer || !contentFrame || !fallbackLink || !fallbackMessage || !closeFrame ) return;

           contentFrame.src = "about:blank"; // Clear previous content
           fallbackMessage.style.display = "none";
           fallbackLink.href = url; // Set fallback link immediately
           frameContainer.classList.add('active');
           showFrameSpinner(true); // Show spinner

            // Attempt to load the URL
           contentFrame.src = url;

           // Clear previous timeout
           clearTimeout(frameLoadTimeout);

           // Set timeout for fallback message
           frameLoadTimeout = setTimeout(() => {
               showFrameSpinner(false); // Hide spinner on timeout
               fallbackMessage.style.display = "block"; // Show fallback
               showNotification("Content took too long to load.", 4000);
           }, 15000); // Increased timeout to 15 seconds

           // Scroll to the frame
           frameContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
       }

        if (contentFrame) {
           contentFrame.onload = function() {
               clearTimeout(frameLoadTimeout); // Clear timeout on successful load start
               showFrameSpinner(false); // Hide spinner

               // Check if content is actually accessible (basic check)
               let accessible = false;
               try {
                   // Try accessing contentDocument. If it throws a cross-origin error, it loaded something.
                   // If it's null or body is empty, it might be blocked or truly empty.
                   const doc = contentFrame.contentDocument || contentFrame.contentWindow?.document;
                   if (doc && doc.body && doc.body.childNodes.length > 0) {
                       accessible = true;
                   } else if (doc) {
                      // It loaded something, maybe just an empty page or blocked content display
                       accessible = true; // Treat as potentially loaded but maybe blocked by X-Frame-Options
                   }
               } catch (e) {
                   // Cross-origin error means something loaded but we can't inspect it. Assume okay unless onerror fires.
                   accessible = true;
                   console.warn("Cross-origin frame loaded. Cannot verify content.", e);
               }

               if (!accessible) {
                  // Fallback if content seems empty or inaccessible after onload
                  fallbackMessage.style.display = "block";
               } else {
                   fallbackMessage.style.display = "none"; // Hide fallback if loaded
               }
           };

            contentFrame.onerror = function() {
               clearTimeout(frameLoadTimeout); // Clear timeout on error
               showFrameSpinner(false); // Hide spinner
               fallbackMessage.style.display = "block"; // Show fallback on error
               showNotification("Error loading content in frame.", 4000);
           };
       }

       dashboardItems.forEach(item => {
           item.addEventListener('click', function(e) {
               const url = this.getAttribute('href');
               const openType = this.dataset.open;

               if (openType === "external") {
                   e.preventDefault();
                   window.open(url, '_blank', 'noopener,noreferrer');
               } else if (openType === "frame") {
                   e.preventDefault();
                   loadContentInFrame(url);
               }
               // Let default behavior happen for "self" or unspecified
           });
       });

        if (closeFrame) {
           closeFrame.addEventListener('click', function() {
               if (!frameContainer || !contentFrame) return;
               frameContainer.classList.remove('active');
               contentFrame.src = "about:blank"; // Clear src
               fallbackMessage.style.display = "none";
               showFrameSpinner(false);
               clearTimeout(frameLoadTimeout); // Clear any pending timeout
           });
       }


      /* --- Whiteboard Setup --- */
      const canvas = document.getElementById('whiteboard');
      let ctx, colorPicker, brushSize, strokes = [], currentStroke = null, eraserEnabled = false, drawing = false;

      if (canvas) {
           ctx = canvas.getContext('2d');
           colorPicker = document.querySelector('.color-picker');
           brushSize = document.querySelector('.brush-size');

           const getEraserColor = () => document.body.classList.contains('dark-mode') ? '#2e2e2e' : '#fff'; // Get current background for eraser

            const renderAll = () => {
               const ratio = window.devicePixelRatio || 1;
               const width = canvas.width / ratio;
               const height = canvas.height / ratio;
               ctx.fillStyle = getEraserColor(); // Use eraser color for background clear to handle transparency/theme change
               ctx.fillRect(0, 0, width, height);

               strokes.forEach(stroke => {
                   if (stroke.tool === 'fill') {
                       ctx.fillStyle = stroke.color;
                       ctx.fillRect(0, 0, width, height);
                   } else {
                       ctx.strokeStyle = stroke.color;
                       ctx.lineWidth = stroke.lineWidth;
                       ctx.lineJoin = 'round';
                       ctx.lineCap = 'round';
                       ctx.beginPath();
                       if (stroke.points.length) {
                           ctx.moveTo(stroke.points[0].x, stroke.points[0].y);
                           for (let i = 1; i < stroke.points.length; i++) {
                               ctx.lineTo(stroke.points[i].x, stroke.points[i].y);
                           }
                           ctx.stroke();
                       }
                   }
               });
                 // Restore current settings after rendering
               ctx.strokeStyle = eraserEnabled ? getEraserColor() : colorPicker.value;
               ctx.lineWidth = parseInt(brushSize.value, 10);
           };

            const resizeCanvas = () => {
               const parent = canvas.parentElement;
               const ratio = window.devicePixelRatio || 1;
               canvas.width = parent.clientWidth * ratio;
               canvas.height = parent.clientHeight * ratio;
               canvas.style.width = parent.clientWidth + 'px';
               canvas.style.height = parent.clientHeight + 'px';
               ctx.scale(ratio, ratio);
               renderAll(); // Re-render after resize
           };


           const getXY = (e) => { /* ... getXY implementation ... */ };
           const startDrawing = (e) => { /* ... startDrawing implementation ... */ };
           const draw = (e) => { /* ... draw implementation ... */ };
           const stopDrawing = () => { /* ... stopDrawing implementation ... */ };

            // --- Whiteboard Event Listeners ---
           canvas.addEventListener('mousedown', startDrawing);
           canvas.addEventListener('mousemove', (e) => { if (drawing) draw(e); });
           canvas.addEventListener('mouseup', stopDrawing);
           canvas.addEventListener('mouseleave', stopDrawing); // Use mouseleave instead of out
           canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e.touches[0]); document.body.style.overflow = 'hidden'; }, { passive: false });
           canvas.addEventListener('touchmove', (e) => { e.preventDefault(); if (drawing) draw(e.touches[0]); }, { passive: false });
           canvas.addEventListener('touchend', () => { stopDrawing(); document.body.style.overflow = ''; });
           canvas.addEventListener('touchcancel', () => { stopDrawing(); document.body.style.overflow = ''; });


           colorPicker.addEventListener('change', () => { if (!drawing) ctx.strokeStyle = eraserEnabled ? getEraserColor() : colorPicker.value; });
           brushSize.addEventListener('change', () => { if (!drawing) ctx.lineWidth = parseInt(brushSize.value, 10); });

           document.querySelector('.clear-button')?.addEventListener('click', () => { strokes = []; renderAll(); showNotification('Whiteboard cleared.'); });
           document.querySelector('.save-button')?.addEventListener('click', () => { try { localStorage.setItem('whiteboardStrokes', JSON.stringify(strokes)); showNotification('Whiteboard saved locally!'); } catch (e) { console.error('Error saving whiteboard:', e); showNotification('Failed to save: Storage limit likely exceeded.', 5000); } });
           document.querySelector('.load-button')?.addEventListener('click', () => { const data = localStorage.getItem('whiteboardStrokes'); if (data) { try { strokes = JSON.parse(data); renderAll(); showNotification('Whiteboard loaded!'); } catch (e) { showNotification('Error parsing saved drawing.'); strokes = []; renderAll(); } } else { showNotification('No saved drawing found.'); } });
           document.querySelector('.undo-button')?.addEventListener('click', () => { if (strokes.length > 0) { strokes.pop(); renderAll(); showNotification('Undo successful.'); } else { showNotification('Nothing to undo.'); } });
           document.querySelector('.fill-button')?.addEventListener('click', () => { strokes.push({ tool: 'fill', color: colorPicker.value }); renderAll(); showNotification('Canvas filled.'); });
           document.querySelector('.eraser-button')?.addEventListener('click', function() { eraserEnabled = !eraserEnabled; this.classList.toggle('active', eraserEnabled); if (!drawing) ctx.strokeStyle = eraserEnabled ? getEraserColor() : colorPicker.value; showNotification(`Eraser ${eraserEnabled ? 'ON' : 'OFF'}`); });
           document.querySelector('.export-png-button')?.addEventListener('click', () => { const dataURL = canvas.toDataURL('image/png'); const link = document.createElement('a'); link.href = dataURL; link.download = 'morrisons-dashboard-notes.png'; document.body.appendChild(link); link.click(); document.body.removeChild(link); showNotification('Downloaded as PNG.'); });


           // Initial setup
           window.addEventListener('resize', debounce(resizeCanvas, 200));
           resizeCanvas(); // Initial resize and render
           // Attempt to load saved strokes on page load
           const initialData = localStorage.getItem('whiteboardStrokes');
            if (initialData) {
                try {
                    strokes = JSON.parse(initialData);
                    renderAll();
                } catch (e) { console.error("Could not load initial whiteboard data."); localStorage.removeItem('whiteboardStrokes'); }
            }


       } else {
            console.log("Whiteboard canvas not found.");
       }


        /* --- Lazy Load Iframes & Add Spinners --- */
        function initLazyIframes() {
            const iframes = document.querySelectorAll('iframe[data-src]');

            const observerCallback = (entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const iframe = entry.target;
                        const loader = iframe.previousElementSibling; // Assuming loader div is right before iframe
                        if (loader && loader.classList.contains('iframe-loading')) {
                             loader.style.display = 'block'; // Show spinner
                         }
                        iframe.src = iframe.getAttribute('data-src');
                        iframe.removeAttribute('data-src'); // Prevent re-triggering
                        obs.unobserve(iframe);
                    }
                });
            };

             const observerOptions = {
               rootMargin: '100px 0px', // Load when iframe is 100px away from viewport
               threshold: 0.01
           };

           const observer = new IntersectionObserver(observerCallback, observerOptions);


           iframes.forEach(iframe => {
               const parentContainer = iframe.parentElement;
               if(parentContainer.classList.contains('iframe-loading-container')) {
                    const loader = parentContainer.querySelector('.iframe-loading');
                     if(loader) loader.style.display = 'none'; // Hide spinner initially

                     iframe.addEventListener('load', () => {
                         if (loader) loader.style.display = 'none'; // Hide spinner on load
                     });
                     iframe.addEventListener('error', () => {
                          if (loader) loader.style.display = 'none'; // Hide spinner on error too
                          console.error("Error loading iframe:", iframe.title || iframe.src);
                          // Optionally show an error message in the container
                      });


                     if ('IntersectionObserver' in window) {
                       observer.observe(iframe);
                   } else {
                       // Fallback for older browsers
                       if (loader) loader.style.display = 'block';
                       iframe.src = iframe.getAttribute('data-src');
                        iframe.removeAttribute('data-src');
                   }
               }
           });
       }


      /* --- DOMContentLoaded --- */
      document.addEventListener('DOMContentLoaded', () => {
        initLazyIframes();
      });

    })();
  </script>
</body>
</html>
